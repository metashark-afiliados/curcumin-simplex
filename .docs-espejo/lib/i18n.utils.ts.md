// .docs-espejo/lib/i18n.utils.ts.md
/**
 * @file i18n.utils.ts.md
 * @description Documento espejo para el aparato de utilidades de i18n.
 * @version 1.0.0
 * @author RaZ podesta - MetaShark Tech
 */

# Manifiesto Conceptual: `i18n.utils.ts`

## 1. Rol Estratégico

El aparato `i18n.utils.ts` es el **"Intérprete de Rutas"** del sistema de internacionalización. Su única y crucial responsabilidad es proporcionar un conjunto de funciones puras, síncronas y sin estado para analizar y manipular las cadenas de texto de las rutas (`pathname`).

Actúa como una librería de bajo nivel, altamente optimizada y confiable, que sirve de soporte tanto a la lógica de borde (en `middleware.ts`) como a los componentes del lado del cliente (`"use client"`) que necesitan determinar el contexto de localización actual a partir de la URL.

## 2. Arquitectura y Flujo de Ejecución

Este aparato no tiene un flujo de ejecución complejo; es una colección de herramientas.

-   **Pureza Absoluta:** Ninguna función en este archivo debe tener efectos secundarios, acceder a APIs externas (como `fetch`), ni depender de estado mutable. Su salida debe depender exclusivamente de sus entradas.
-   **Dependencias Mínimas:** Su única dependencia es `i18n.config.ts`, la SSoT para la lista de locales soportados, garantizando que sus operaciones siempre estén alineadas con la configuración del proyecto.
-   **Consumo:** Es consumido por aparatos de nivel superior que necesitan tomar decisiones basadas en la estructura de la URL.

## 3. Contrato de API

### `pathnameHasLocale(pathname: string): boolean`

-   **Entrada:** Una cadena `pathname` (ej. `/es-ES/about`).
-   **Salida:** Un booleano.
-   **Propósito:** Responder a la pregunta: "¿Esta ruta ya ha sido procesada por el middleware de i18n?".

### `getCurrentLocaleFromPathname(pathname: string): Locale`

-   **Entrada:** Una cadena `pathname`.
-   **Salida:** Un tipo `Locale` (ej. `"es-ES"`).
-   **Propósito:** Extraer de forma segura el `locale` de la URL, con un fallback garantizado al `defaultLocale`.

## 4. Zona de Melhorias Futuras

1.  **Optimización de Rendimiento:** Aunque las funciones actuales son extremadamente rápidas, para un sitio con miles de locales, se podría explorar el uso de una estructura de datos `Set` o un `Map` pre-calculado para la búsqueda de locales en `pathnameHasLocale`, en lugar de `Array.prototype.some`.
2.  **Utilidad de "Switch Locale":** Añadir una nueva función `switchPathnameLocale(pathname: string, newLocale: Locale): string` que tome una ruta y un nuevo `locale` y devuelva la nueva ruta correctamente formateada (ej. `switchPathnameLocale("/es-ES/about", "en-US")` -> `/en-US/about`). Esto centralizaría la lógica que actualmente está en `LanguageSwitcher`.

---
// .docs-espejo/lib/i18n.utils.ts.md