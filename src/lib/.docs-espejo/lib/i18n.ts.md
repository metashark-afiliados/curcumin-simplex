# /.docs-espejo/lib/i18n.ts.md
/**
 * @file .docs-espejo/lib/i18n.ts.md
 * @description Documento espejo para el aparato ensamblador de diccionarios del portal.
 * @version 1.0.0
 * @author RaZ podesta - MetaShark Tech
 */

# Manifiesto Conceptual: El Ensamblador de Contenido del Portal

## 1. Rol Estratégico

El aparato `i18n.ts` es el **orquestador de contenido para el dominio del Portal**. Su única responsabilidad es recolectar todos los fragmentos de contenido (`.i18n.json`) dispersos en la estructura del proyecto, ensamblarlos en un único objeto de diccionario para un `locale` específico, validar su integridad contra el `i18n.schema.ts` y cachear el resultado.

Actúa como una fachada (Facade Pattern) que simplifica la obtención de contenido para cualquier página o componente del portal, proveyendo una única función `getDictionary(locale)`.

## 2. Arquitectura y Flujo de Ejecución

Este aparato es `server-only` y su lógica de ejecución es la siguiente:

1.  **Importación Estática:** Importa todos los archivos `.i18n.json` necesarios para construir el diccionario del portal. Estos se organizan en una lista estructurada (`allI18nModules`) para mejorar la mantenibilidad.
2.  **Cacheo:** Mantiene un objeto `dictionariesCache` en memoria. Al recibir una solicitud para un `locale`, primero verifica si el diccionario para ese idioma ya fue construido y está en caché. Si es así, lo devuelve inmediatamente.
3.  **Validación de Locale:** Si no está en caché, valida el `locale` solicitado contra la SSoT (`i18n.config.ts`), usando un fallback seguro si es inválido.
4.  **Ensamblaje:** Itera sobre la lista `allI18nModules`. Para cada módulo, extrae el objeto de contenido correspondiente al `locale` solicitado y lo fusiona en un único y gran objeto (`fullDictionary`).
5.  **Validación del Contrato:** Valida el `fullDictionary` ensamblado contra el `i18nSchema` global. Este es un paso de control de calidad crítico. Si la validación falla (debido a una clave faltante o un tipo de dato incorrecto), lanza un error detallado que detiene el proceso de build, previniendo errores en producción.
6.  **Puesta en Caché y Retorno:** Si la validación es exitosa, guarda el diccionario validado en `dictionariesCache` y lo devuelve.

## 3. Contrato de API

### `getDictionary(locale: string)`
*   **Entrada:** `string` - El código del `locale` solicitado (ej. "es-ES").
*   **Salida:** `Promise<Dictionary>` - Una promesa que se resuelve con el objeto de diccionario completo, validado y tipado para ese `locale`.

## 4. Zona de Melhorias Futuras

1.  **Carga Dinámica de Módulos:** En lugar de importar estáticamente todos los JSON, se podría usar una función que lea el directorio `src/messages` y cargue los módulos dinámicamente. Esto haría que añadir un nuevo componente no requiera modificar este archivo, aunque a costa de una menor claridad explícita.
2.  **Cacheo Persistente:** Para builds en entornos serverless, el cacheo en memoria se pierde entre invocaciones. Se podría implementar una capa de cacheo más persistente (ej. Redis, o el sistema de cacheo de Next.js) para diccionarios de uso muy frecuente.
3.  **División de Diccionarios:** Para aplicaciones extremadamente grandes, en lugar de un único `getDictionary`, se podrían crear funciones específicas (`getHeaderDictionary`, `getFooterDictionary`) que ensamblen solo los fragmentos necesarios para reducir la huella de memoria.